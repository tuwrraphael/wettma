!function(){"use strict";var e;let s;!function(e){e[e.Unset=0]="Unset",e[e.InProgress=1]="InProgress",e[e.Successful=2]="Successful",e[e.Failed=3]="Failed"}(e||(e={})),s="https://wettma.azurewebsites.net";const t="https://wettma.azurewebsites.net";let a=null,n=[],i={upcomingGames:[],goToLogin:!1,goToRegister:!1,accessToken:null,displayName:null,userId:null,register:e.Unset,scoreboard:[],scoreboardRequest:e.Unset,setResultRequest:e.Unset,placeComputerBetsRequest:e.Unset,finishedGames:[],gameBets:{},hasMoreFinishedGames:!1,participants:[]},c=[];function o(e){i=e(i),self.postMessage(i)}let r=[];async function g(){let e=async function(){let e=new Headers;i.accessToken&&e.append("Authorization",`Bearer ${i.accessToken.token}`),e.append("X-Frontend-Version","1"),null!=a&&e.append("X-Frontend-Standalone",a?"true":"false");let s=await fetch(`${t}/games?contestId=3`,{headers:e}),c=await s.json();n=c.filter((e=>e.result)).map((e=>{let s=n.find((s=>s.id==e.id));return Object.assign(Object.assign({},s),{id:e.id,team1:e.team1,team2:e.team2,time:new Date(e.time),myBet:e.myBet?{choice:e.myBet.choice,odds:{team1:e.myBet.odds.team1Odds,team2:e.myBet.odds.team2Odds,draw:e.myBet.odds.drawOdds}}:null,result:{team1Goals:e.result.team1Goals,team2Goals:e.result.team2Goals},points:e.points})})).sort(((e,s)=>+s.time-+e.time)),o((e=>{let s=n.slice(0,n.length>5?5:n.length);return Object.assign(Object.assign({},e),{upcomingGames:c.filter((e=>!e.result)).map((s=>{let t=e.upcomingGames.find((e=>e.id==s.id));return Object.assign(Object.assign({},t),{id:s.id,team1:s.team1,team2:s.team2,time:new Date(s.time),myBet:s.myBet?{choice:s.myBet.choice,odds:{team1:s.myBet.odds.team1Odds,team2:s.myBet.odds.team2Odds,draw:s.myBet.odds.drawOdds}}:null,points:s.points})})).sort(((e,s)=>+e.time-+s.time)),finishedGames:s,hasMoreFinishedGames:s.length<n.length})}))}(),s=async function(){let e=await fetch(`${t}/odds?contestId=3`);return c=await e.json(),c}(),[r,g]=await Promise.all([e,s]);o((e=>{let s=[...e.upcomingGames];for(let e of g){let t=s.find((s=>e.gameId==s.id));if(t&&+t.time>+new Date-3e5){let a=s.indexOf(t);s[a]=Object.assign(Object.assign({},t),{odds:{draw:e.drawOdds,id:e.id,team1:e.team1Odds,team2:e.team2Odds}})}}return Object.assign(Object.assign({},e),{upcomingGames:s})}))}function d(e,s){o((t=>{let a=[...t.upcomingGames],n=a.find((s=>e==s.id)),i=a.indexOf(n);return a[i]=Object.assign(Object.assign({},n),s),Object.assign(Object.assign({},t),{upcomingGames:a})}))}async function m(e){let s=await fetch(`${t}/user/profile`,{headers:{Authorization:`Bearer ${e.token}`}});if(401==s.status)o((s=>Object.assign(Object.assign({},s),{goToRegister:!0,accessToken:e})));else if(200==s.status){let t=await s.json();return o((s=>Object.assign(Object.assign({},s),{accessToken:e,userId:t.userId,displayName:t.displayName}))),!0}return!1}async function l(s){if(i.accessToken||![10].includes(s.type))switch(s.type){case 0:await async function(e){let s=c.find((s=>s.id==e.oddsId));d(s.gameId,{saving:!0,saveError:null}),null==i.accessToken?o((e=>Object.assign(Object.assign({},e),{goToLogin:!0}))):null==i.userId&&o((e=>Object.assign(Object.assign({},e),{goToRegister:!0})));try{let a=await fetch(`${t}/bets`,{headers:{Authorization:`Bearer ${i.accessToken.token}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({oddsId:e.oddsId,choice:e.choice})});if(200==a.status)d(s.gameId,{myBet:{choice:e.choice,odds:{draw:s.drawOdds,team1:s.team1Odds,team2:s.team2Odds}},saving:!1});else if(400==a.status){let e=await a.json();"oddschanged"==e.type||"oddsexpired"==e.type?(d(s.gameId,{saving:!1,saveError:{oddsChanged:!0}}),await g()):"gamestarted"==e.type?(d(s.gameId,{saving:!1,saveError:{gameStarted:!0}}),await g()):d(s.gameId,{saving:!1,saveError:{unknown:!0}})}}catch(e){d(s.gameId,{saving:!1,saveError:{unknown:!0}})}}(s);break;case 1:o((e=>Object.assign(Object.assign({},e),{goToLogin:!1})));break;case 2:await async function(e){if(a=e.isStandalone,e.accessToken&&await m(e.accessToken),await g(),r.length>0){for(let e of r)await l(e);r=[]}}(s);break;case 3:await async function(s){o((s=>Object.assign(Object.assign({},s),{register:e.InProgress,goToRegister:!1})));try{201==(await fetch(`${t}/user/register`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({displayName:s.displayName,token:i.accessToken.token})})).status?await m(i.accessToken)&&o((s=>Object.assign(Object.assign({},s),{register:e.Successful}))):o((s=>Object.assign(Object.assign({},s),{register:e.Failed})))}catch(s){o((s=>Object.assign(Object.assign({},s),{register:e.Failed})))}}(s);break;case 4:await async function(e){"credentials"in navigator&&"preventSilentAccess"in navigator.credentials&&navigator.credentials.preventSilentAccess(),o((e=>Object.assign(Object.assign({},e),{accessToken:null,displayName:null,userId:null}))),await g()}();break;case 5:await async function(s){o((s=>Object.assign(Object.assign({},s),{scoreboardRequest:e.InProgress})));try{let s=await fetch(`${t}/scoreboard?contestId=3`);if(!s.ok)return void o((s=>Object.assign(Object.assign({},s),{scoreboardRequest:e.Failed})));let a=(await s.json()).sort(((e,s)=>s.points-e.points||e.displayName.localeCompare(s.displayName))).map(((e,s)=>({displayName:e.displayName,points:e.points,userId:e.userId,place:s+1})));o((s=>Object.assign(Object.assign({},s),{scoreboardRequest:e.Successful,scoreboard:a})))}catch(s){o((s=>Object.assign(Object.assign({},s),{scoreboardRequest:e.Failed})))}}();break;case 6:await async function(s){o((s=>Object.assign(Object.assign({},s),{setResultRequest:e.InProgress})));try{(await fetch(`${t}/games/${s.gameId}/result`,{headers:{Authorization:`Bearer ${i.accessToken.token}`,"Content-Type":"application/json"},method:"PUT",body:JSON.stringify({team1Goals:s.team1Goals,team2Goals:s.team2Goals})})).ok?o((s=>Object.assign(Object.assign({},s),{setResultRequest:e.Successful}))):o((s=>Object.assign(Object.assign({},s),{setResultRequest:e.Failed})))}catch(s){o((s=>Object.assign(Object.assign({},s),{setResultRequest:e.Failed})))}}(s);break;case 9:await async function(s){o((s=>Object.assign(Object.assign({},s),{placeComputerBetsRequest:e.InProgress})));try{(await fetch(`${t}/computer/bets`,{headers:{Authorization:`Bearer ${i.accessToken.token}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(s.request)})).ok?o((s=>Object.assign(Object.assign({},s),{placeComputerBetsRequest:e.Successful}))):o((s=>Object.assign(Object.assign({},s),{placeComputerBetsRequest:e.Failed})))}catch(s){o((s=>Object.assign(Object.assign({},s),{placeComputerBetsRequest:e.Failed})))}}(s);break;case 7:await async function(s){o((t=>Object.assign(Object.assign({},t),{gameBets:Object.assign(Object.assign({},t.gameBets),{[s.gameId]:Object.assign(Object.assign({},t.gameBets[s.gameId]),{requestState:e.InProgress,computerBetRequestState:e.InProgress})})})));try{let a=await fetch(`${t}/games/${s.gameId}/bets`);if(!a.ok)return void o((t=>Object.assign(Object.assign({},t),{gameBets:Object.assign(Object.assign({},t.gameBets),{[s.gameId]:Object.assign(Object.assign({},t.gameBets[s.gameId]),{requestState:e.Failed})})})));let n=await a.json();o((t=>Object.assign(Object.assign({},t),{gameBets:Object.assign(Object.assign({},t.gameBets),{[s.gameId]:Object.assign(Object.assign({},t.gameBets[s.gameId]),{requestState:e.Successful,bets:n.map((e=>({displayName:e.displayName,choice:e.choice,userId:e.userId})))})})})))}catch(t){o((t=>Object.assign(Object.assign({},t),{gameBets:Object.assign(Object.assign({},t.gameBets),{[s.gameId]:Object.assign(Object.assign({},t.gameBets[s.gameId]),{requestState:e.Failed})})})))}try{let a=await fetch(`${t}/computer/games/${s.gameId}/bets`);if(!a.ok)return void o((t=>Object.assign(Object.assign({},t),{gameBets:Object.assign(Object.assign({},t.gameBets),{[s.gameId]:Object.assign(Object.assign({},t.gameBets[s.gameId]),{computerBetRequestState:e.Failed})})})));let n=await a.json();o((t=>Object.assign(Object.assign({},t),{gameBets:Object.assign(Object.assign({},t.gameBets),{[s.gameId]:Object.assign(Object.assign({},t.gameBets[s.gameId]),{computerBetRequestState:e.Successful,computerBets:n.map((e=>({displayName:e.displayName,choice:e.choice,reason:e.reason,computerPlayerId:e.computerPlayerId})))})})})))}catch(t){o((t=>Object.assign(Object.assign({},t),{gameBets:Object.assign(Object.assign({},t.gameBets),{[s.gameId]:Object.assign(Object.assign({},t.gameBets[s.gameId]),{requestState:e.Failed})})})))}}(s);break;case 10:await async function(e){try{let e=await fetch(`${t}/participants?contestId=3`,{headers:{Authorization:`Bearer ${i.accessToken.token}`}});if(!e.ok)return;let s=await e.json();o((e=>Object.assign(Object.assign({},e),{participants:s})))}catch(e){console.error(e)}}();break;case 8:await async function(){o((e=>{let s=e.finishedGames.length+10,t=n.slice(0,n.length>s?s:n.length);return Object.assign(Object.assign({},e),{finishedGames:t,hasMoreFinishedGames:t.length<n.length})}))}()}else r.push(s)}self.addEventListener("message",(e=>{l(e.data).catch((e=>console.error(e)))}))}();
//# sourceMappingURL=e7aa02bfab514c519243.bundle.js.map